import{d as v}from"./chunk-FIXGM7CA.js";import{a as n,b as O,c as I,d as y,e as A,f as R}from"./chunk-XIAVSE5S.js";import{m as T}from"./chunk-337TLXEY.js";import{A as b,Ja as m,O as M,R as u,X as s,i as S,xb as g}from"./chunk-MGJER5G2.js";import{a as d,b as f}from"./chunk-2VMXMS7J.js";var c=class e{static TODOS=["ADMIN","OPERADOR","ANONYMOUS"];static USER=["ADMIN"];MENUS=[{icon:"visao_geral.png",label:"Vis\xE3o Geral",path:"/",permissions:e.TODOS},{icon:"buffers.png",label:"Buffers",path:"/buffers",permissions:e.TODOS},{icon:"botoeira.png",label:"Botoeiras",path:"/botoeiras",permissions:e.TODOS,submenus:[{label:"Chamados",path:"/calls",permissions:e.TODOS},{label:"Comunica\xE7\xE3o",path:"/communications",permissions:e.TODOS}]},{icon:"historico.png",label:"Hist\xF3rico",path:"/histories",permissions:e.TODOS},{icon:"usuarios.png",label:"Usu\xE1rios",path:"/users",permissions:e.USER}];menus=m(this.MENUS);recreate(){this.menus.set([]),setTimeout(()=>this.menus.set([...this.MENUS]),2)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"})};var l=class e{get(t){if(!t)return null;let r=t+"=",a=document.cookie.split(";");for(let i=0;i<a.length;i++){let o=a[i];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(r)===0)return o.substring(r.length,o.length)}return null}set(t,r,a){let i="";if(a){let o=new Date;o.setTime(o.getTime()+a*24*60*60*1e3),i="; expires="+o.toString()}document.cookie=t+"="+JSON.stringify(r)+i+"; path=/"}delete(t){this.set(t,"",-1)}update(t,r){this.set(t,r)}exists(t){return!!this.get(t)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"})};var p=class e{http=s(T);storage=s(l);_auth=m(null);router=s(v);login(t){return this.http.post(`${R.REST}/users/login`,t)}get auth(){if(!this._auth()){let t=this.storage.get("user");t&&this._auth.set(JSON.parse(t))}return this._auth.asReadonly()}isLogged(){return this.storage.exists("user")}logout(){this.storage.delete("user"),this._auth.set(null),this.redirect()}redirect(t="/"){this.router.navigateByUrl(t)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"})};var D={authState:{state:"idle",data:null}},K=O({providedIn:"root"},A(D),y((e,t=s(p),r=s(l),a=s(c))=>({login(i){return n(e,{authState:{data:null,state:"loading"}}),t.login(i).pipe(M(o=>{if(o&&o.token){let h=f(d({},o),{username:i.username});r.set("user",h,1),n(e,{authState:{data:h,state:"success"}}),t.redirect()}else n(e,{authState:{data:null,state:"error",message:o.message}})}),b(o=>(console.log(o),n(e,{authState:{data:null,state:"error",message:"Falha de conex\xE3o com servidor"}}),S)))},auth(){let i=t.auth;return n(e,{authState:{data:i(),state:"success"}}),i},logout(){n(e,{authState:{data:null,state:"idle"}}),t.logout(),a.recreate()}})),I(({authState:e},t=s(p))=>({permission:g(()=>t.auth()?.role??"ANONYMOUS"),isLogged:g(()=>!!t.isLogged())})));export{c as a,p as b,K as c};
