import{a as k}from"./chunk-AZYVGLQ2.js";import{a as z}from"./chunk-BAP55IBU.js";import{a as l,b as J,c as K,d as L,e as Q}from"./chunk-4IFBPCWC.js";import{a as j}from"./chunk-ZQFK667Q.js";import{a as R}from"./chunk-ANSMRTUX.js";import{$a as O,A as E,Ba as d,Bb as m,D as M,Db as V,M as q,O as S,Oa as D,R as N,Tb as Y,Va as A,Wa as u,X as p,Xa as f,Ya as v,Z as h,Za as a,_a as n,db as c,i as w,ib as r,jb as P,kb as I,la as G,lb as C,mb as _,qa as H,w as F,y as T}from"./chunk-6VFV3J45.js";import{a as g,b}from"./chunk-2VMXMS7J.js";var x=class e{http=p(Y);loadMissionsPending(){return this.http.post(`${R.REST}/mission/status/pending`,{})}loadMissionsFinish(){return this.http.post(`${R.REST}/mission/status/finish`,{})}loadAlerts(){return this.http.post(`${R.REST}/history/alerts`,{})}static \u0275fac=function(i){return new(i||e)};static \u0275prov=N({token:e,factory:e.\u0275fac})};var Z={alertState:{data:null,state:"idle",pesquisando:!1},missionPendingState:{data:null,state:"idle",pesquisando:!1},missionFinishState:{data:null,state:"idle",pesquisando:!1}},y=J(Q(Z),L((e,t=p(x),i=p(z))=>({loadAlerts(){l(e,{alertState:{data:null,state:"loading",pesquisando:!1}}),F(0,2e3).pipe(j(),T(()=>!e.alertState().pesquisando),S(()=>l(e,o=>({alertState:b(g({},o.alertState),{pesquisando:!0})}))),q(()=>t.loadAlerts().pipe(M(1),S(o=>{l(e,{alertState:{data:o,state:"success",pesquisando:!1}})}),E(o=>(l(e,{alertState:{data:null,state:"error",pesquisando:!1}}),i.error(o.message),w))))).subscribe()},loadMissionsPending(o){l(e,{missionPendingState:{data:null,state:"loading",pesquisando:!1}}),F(0,2e3).pipe(j(o),T(()=>!e.missionPendingState().pesquisando),S(()=>l(e,s=>({missionPendingState:b(g({},s.missionPendingState),{pesquisando:!0})}))),q(()=>t.loadMissionsPending().pipe(M(1),S(s=>{l(e,{missionPendingState:{data:s,state:"success",pesquisando:!1}})}),E(s=>(l(e,{missionPendingState:{data:null,state:"error",pesquisando:!1}}),i.error(s.message),w))))).subscribe()},loadMissionsFinish(o){l(e,{missionFinishState:{data:null,state:"loading",pesquisando:!1}}),F(0,2e3).pipe(j(o),T(()=>!e.missionFinishState().pesquisando),S(()=>l(e,s=>({missionFinishState:b(g({},s.missionFinishState),{pesquisando:!0})}))),q(()=>t.loadMissionsFinish().pipe(M(1),S(s=>{l(e,{missionFinishState:{data:s,state:"success",pesquisando:!1}})}),E(s=>(l(e,{missionFinishState:{data:null,state:"error",pesquisando:!1}}),i.error(s.message),w))))).subscribe()}})),K(e=>({alertColumns:m(()=>e.alertState()?.data?Object.keys(e.alertState().data[0]):[]),alertRows:m(()=>e.alertState()?.data?e.alertState().data?.map(t=>Object.values(t)):[])})));function ee(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2,"Carregando..."),n()())}function te(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2," Erro ao carregar dados "),n()())}function ie(e,t){if(e&1&&(a(0,"th"),r(1),n()),e&2){let i=t.$implicit;d(),P(i)}}function ne(e,t){if(e&1&&(a(0,"td"),r(1),n()),e&2){let i=t.$index,o=c().$implicit,s=c(2);d(),I(" ",s.isAndFormattedDate(o[i])," ")}}function se(e,t){if(e&1&&(a(0,"tr"),f(1,ne,2,1,"td",null,u),n()),e&2){let i=c(2);d(),v(i.columns())}}function ae(e,t){if(e&1&&(a(0,"table",1)(1,"thead")(2,"tr"),f(3,ie,2,1,"th",null,u),n()(),a(5,"tbody"),f(6,se,3,0,"tr",null,u),n()()),e&2){let i=c();d(3),v(i.columns()),d(3),v(i.rows())}}var $=class e{missionType=H.required();overviewStore=p(y);destroyRef=p(G);state=m(()=>this.overviewStore.missionPendingState().state);columns=m(()=>[]);rows=m(()=>[]);dataUtil=k.init();constructor(){V(()=>{this.state=m(()=>{let t=this.overviewStore.missionPendingState;return this.missionType()==="finish"&&(t=this.overviewStore.missionFinishState),t().state}),this.columns=m(()=>{let t=this.overviewStore.missionPendingState;return this.missionType()==="finish"&&(t=this.overviewStore.missionFinishState),t()?.data?Object.keys(t().data[0]):[]}),this.rows=m(()=>{let t=this.overviewStore.missionPendingState;return this.missionType()==="finish"&&(t=this.overviewStore.missionFinishState),t()?.data?t().data?.map(i=>Object.values(i)):[]})})}ngOnInit(){this.missionType()==="pending"?this.overviewStore.loadMissionsPending(this.destroyRef):this.overviewStore.loadMissionsFinish(this.destroyRef)}isAndFormattedDate(t){return this.dataUtil.isAndFormattedDate(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=h({type:e,selectors:[["app-missions"]],inputs:{missionType:[1,"missionType"]},standalone:!0,features:[C([]),_],decls:3,vars:1,consts:[[1,"card"],[1,"table","table-striped","table-bordered","mt-3"],[1,"card-body","d-flex","justify-content-center"]],template:function(i,o){if(i&1&&D(0,ee,3,0,"div",0)(1,te,3,0,"div",0)(2,ae,8,0,"table",1),i&2){let s;A((s=o.state())==="loading"?0:s==="error"?1:s==="success"?2:-1)}}})};function oe(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2," Carregando alertas... "),n()())}function re(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2," Erro ao carregar dados "),n()())}function le(e,t){if(e&1&&(a(0,"th"),r(1),n()),e&2){let i=t.$implicit;d(),P(i)}}function de(e,t){if(e&1&&(a(0,"td"),r(1),n()),e&2){let i=t.$index,o=c().$implicit,s=c(2);d(),I(" ",s.isAndFormattedDate(o[i])," ")}}function me(e,t){if(e&1&&(a(0,"tr"),f(1,de,2,1,"td",null,u),n()),e&2){let i=c(2);d(),v(i.alertColumns())}}function pe(e,t){if(e&1&&(a(0,"table",1)(1,"thead")(2,"tr"),f(3,le,2,1,"th",null,u),n()(),a(5,"tbody"),f(6,me,3,0,"tr",null,u),n()()),e&2){let i=c();d(3),v(i.alertColumns()),d(3),v(i.alertRows())}}var U=class e{overviewStore=p(y);alertColumns=this.overviewStore.alertColumns;alertRows=this.overviewStore.alertRows;state=m(()=>this.overviewStore.alertState().state);dataUtil=k.init();constructor(){this.overviewStore.loadAlerts()}isAndFormattedDate(t){return this.dataUtil.isAndFormattedDate(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=h({type:e,selectors:[["app-alerts"]],standalone:!0,features:[C([]),_],decls:3,vars:1,consts:[[1,"card"],[1,"table","table-striped","table-bordered","mt-3"],[1,"card-body","d-flex","justify-content-center"]],template:function(i,o){if(i&1&&D(0,oe,3,0,"div",0)(1,re,3,0,"div",0)(2,pe,8,0,"table",1),i&2){let s;A((s=o.state())==="loading"?0:s==="error"?1:s==="success"?2:-1)}}})};var X=class e{static \u0275fac=function(i){return new(i||e)};static \u0275cmp=h({type:e,selectors:[["app-overview"]],standalone:!0,features:[C([x,y]),_],decls:14,vars:0,consts:[[1,"d-flex","flex-column"],["missionType","pending"],["missionType","finish"]],template:function(i,o){i&1&&(a(0,"h3"),r(1,"Vis\xE3o Geral"),n(),a(2,"div",0)(3,"h4"),r(4,"Movimentos Pendentes"),n(),O(5,"app-missions",1),n(),a(6,"div",0)(7,"h4"),r(8,"\xDAltimas Miss\xF5es - Movimentos Conclu\xEDdos"),n(),O(9,"app-missions",2),n(),a(10,"div",0)(11,"h4"),r(12,"\xDAltimos Alertas"),n(),O(13,"app-alerts"),n())},dependencies:[$,U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})};export{X as OverviewComponent};
