import{a as f}from"./chunk-ZQFK667Q.js";import{a as q}from"./chunk-BAP55IBU.js";import{a,b as y,c as C,d as R,e as E}from"./chunk-4IFBPCWC.js";import{a as c}from"./chunk-LZOUE64L.js";import{A as u,Bb as i,D as S,M as b,O as s,R as h,Tb as v,X as n,i as r,w as p,y as d}from"./chunk-6VFV3J45.js";var m=class t{http=n(v);loadCalls(){return this.http.post(`${c.REST}/button/call/list`,{})}loadCommunications(){return this.http.post(`${c.REST}/button/comm`,{})}abortCall(o){return this.http.post(`${c.REST}/button/call/abort/${o}`,{})}static \u0275fac=function(l){return new(l||t)};static \u0275prov=h({token:t,factory:t.\u0275fac})};var j={callsState:{data:null,state:"idle"},communicationsState:{data:null,state:"idle"},removeState:{data:null,state:"idle"},pesquisando:!1},H=y(E(j),R((t,o=n(m),l=n(q))=>({loadCalls(){a(t,{callsState:{data:null,state:"loading"},pesquisando:!1}),p(0,5e3).pipe(f(),d(()=>!t.pesquisando()),s(()=>a(t,{pesquisando:!0})),b(()=>o.loadCalls().pipe(S(1),s(e=>{e&&e.length>0?a(t,{callsState:{data:e,state:"success"}}):a(t,{callsState:{data:e,state:"noresult"}})}),u(e=>(a(t,{callsState:{data:null,state:"error"}}),l.error(e.message),r)))),s(()=>a(t,{pesquisando:!1}))).subscribe()},loadCommunications(){a(t,{communicationsState:{data:null,state:"loading"},pesquisando:!1}),p(0,2e3).pipe(f(),d(()=>!t.pesquisando()),s(()=>a(t,{pesquisando:!0})),b(()=>o.loadCommunications().pipe(s(e=>{e&&e.length>0?a(t,{communicationsState:{data:e,state:"success"}}):a(t,{communicationsState:{data:e,state:"noresult"}})}),u(e=>(a(t,{communicationsState:{data:null,state:"error"}}),l.error(e.message),r)))),s(()=>a(t,{pesquisando:!1}))).subscribe()},abortCall(e){a(t,{}),o.abortCall(e).pipe(S(1),s(()=>{a(t,{removeState:{data:null,state:"success"}}),l.success("Removido com sucesso.")}),u(g=>(a(t,{removeState:{data:null,state:"error"}}),l.error(g.message),r))).subscribe()}})),C(t=>({callsColumns:i(()=>t.callsState()?.data?Object.keys(t.callsState().data[0]):[]),callsRows:i(()=>t.callsState()?.data?t.callsState().data?.map(o=>Object.values(o)):[]),communicationsColumns:i(()=>t.communicationsState()?.data?Object.keys(t.communicationsState().data[0]):[]),communicationsRows:i(()=>t.communicationsState()?.data?t.communicationsState().data?.map(o=>Object.values(o)):[])})));export{m as a,H as b};
