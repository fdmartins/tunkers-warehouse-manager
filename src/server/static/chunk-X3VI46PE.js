import{a as k}from"./chunk-AZYVGLQ2.js";import{a as j}from"./chunk-ZQFK667Q.js";import{a as z}from"./chunk-BAP55IBU.js";import{a as l,b as J,c as K,d as L,e as Q}from"./chunk-4IFBPCWC.js";import{a as R}from"./chunk-LZOUE64L.js";import{$a as O,A as E,Ba as m,Bb as d,D as M,Db as V,M as q,O as S,Oa as D,R as N,Tb as Y,Va as A,Wa as u,X as p,Xa as f,Ya as v,Z as h,Za as a,_a as s,db as c,i as w,ib as r,jb as P,kb as I,la as G,lb as _,mb as C,qa as H,w as F,y as T}from"./chunk-6VFV3J45.js";import{a as g,b}from"./chunk-2VMXMS7J.js";var x=class e{http=p(Y);loadMissionsPending(){return this.http.post(`${R.REST}/mission/status/pending`,{})}loadMissionsFinish(){return this.http.post(`${R.REST}/mission/status/finish`,{})}loadAlerts(){return this.http.post(`${R.REST}/history/alerts`,{})}static \u0275fac=function(i){return new(i||e)};static \u0275prov=N({token:e,factory:e.\u0275fac})};var Z={alertState:{data:null,state:"idle",pesquisando:!1},missionPendingState:{data:null,state:"idle",pesquisando:!1},missionFinishState:{data:null,state:"idle",pesquisando:!1}},y=J(Q(Z),L((e,t=p(x),i=p(z))=>({loadAlerts(){l(e,{alertState:{data:null,state:"loading",pesquisando:!1}}),F(0,2e3).pipe(j(),T(()=>!e.alertState().pesquisando),S(()=>l(e,o=>({alertState:b(g({},o.alertState),{pesquisando:!0})}))),q(()=>t.loadAlerts().pipe(M(1),S(o=>{l(e,{alertState:{data:o,state:o&&o.length>0?"success":"noresult",pesquisando:!1}})}),E(o=>(l(e,{alertState:{data:null,state:"error",pesquisando:!1}}),i.error(o.message),w))))).subscribe()},loadMissionsPending(o){l(e,{missionPendingState:{data:null,state:"loading",pesquisando:!1}}),F(0,2e3).pipe(j(o),T(()=>!e.missionPendingState().pesquisando),S(()=>l(e,n=>({missionPendingState:b(g({},n.missionPendingState),{pesquisando:!0})}))),q(()=>t.loadMissionsPending().pipe(M(1),S(n=>{l(e,{missionPendingState:{data:n,state:n&&n.length>0?"success":"noresult",pesquisando:!1}})}),E(n=>(l(e,{missionPendingState:{data:null,state:"error",pesquisando:!1}}),i.error(n.message),w))))).subscribe()},loadMissionsFinish(o){l(e,{missionFinishState:{data:null,state:"loading",pesquisando:!1}}),F(0,2e3).pipe(j(o),T(()=>!e.missionFinishState().pesquisando),S(()=>l(e,n=>({missionFinishState:b(g({},n.missionFinishState),{pesquisando:!0})}))),q(()=>t.loadMissionsFinish().pipe(M(1),S(n=>{l(e,{missionFinishState:{data:n,state:n&&n.length>0?"success":"noresult",pesquisando:!1}})}),E(n=>(l(e,{missionFinishState:{data:null,state:"error",pesquisando:!1}}),i.error(n.message),w))))).subscribe()}})),K(e=>({alertColumns:d(()=>e.alertState()?.data?Object.keys(e.alertState().data[0]):[]),alertRows:d(()=>e.alertState()?.data?e.alertState().data?.map(t=>Object.values(t)):[])})));function ee(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2,"Carregando..."),s()())}function te(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2," Erro ao carregar dados "),s()())}function ie(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2,"Sem resultados"),s()())}function ne(e,t){if(e&1&&(a(0,"th"),r(1),s()),e&2){let i=t.$implicit;m(),P(i)}}function se(e,t){if(e&1&&(a(0,"td"),r(1),s()),e&2){let i=t.$index,o=c().$implicit,n=c(2);m(),I(" ",n.isAndFormattedDate(o[i])," ")}}function ae(e,t){if(e&1&&(a(0,"tr"),f(1,se,2,1,"td",null,u),s()),e&2){let i=c(2);m(),v(i.columns())}}function oe(e,t){if(e&1&&(a(0,"table",1)(1,"thead")(2,"tr"),f(3,ne,2,1,"th",null,u),s()(),a(5,"tbody"),f(6,ae,3,0,"tr",null,u),s()()),e&2){let i=c();m(3),v(i.columns()),m(3),v(i.rows())}}var $=class e{missionType=H.required();overviewStore=p(y);destroyRef=p(G);state=d(()=>this.overviewStore.missionPendingState().state);columns=d(()=>[]);rows=d(()=>[]);dataUtil=k.init();constructor(){V(()=>{this.state=d(()=>{let t=this.overviewStore.missionPendingState;return this.missionType()==="finish"&&(t=this.overviewStore.missionFinishState),t().state}),this.columns=d(()=>{let t=this.overviewStore.missionPendingState;return this.missionType()==="finish"&&(t=this.overviewStore.missionFinishState),t()?.data?Object.keys(t().data[0]):[]}),this.rows=d(()=>{let t=this.overviewStore.missionPendingState;return this.missionType()==="finish"&&(t=this.overviewStore.missionFinishState),t()?.data?t().data?.map(i=>Object.values(i)):[]})})}ngOnInit(){this.missionType()==="pending"?this.overviewStore.loadMissionsPending(this.destroyRef):this.overviewStore.loadMissionsFinish(this.destroyRef)}isAndFormattedDate(t){return this.dataUtil.isAndFormattedDate(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=h({type:e,selectors:[["app-missions"]],inputs:{missionType:[1,"missionType"]},standalone:!0,features:[_([]),C],decls:4,vars:1,consts:[[1,"card"],[1,"table","table-striped","table-bordered","mt-3"],[1,"card-body","d-flex","justify-content-center"]],template:function(i,o){if(i&1&&D(0,ee,3,0,"div",0)(1,te,3,0,"div",0)(2,ie,3,0,"div",0)(3,oe,8,0,"table",1),i&2){let n;A((n=o.state())==="loading"?0:n==="error"?1:n==="noresult"?2:n==="success"?3:-1)}}})};function re(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2," Carregando alertas... "),s()())}function le(e,t){e&1&&(a(0,"div",0)(1,"div",2),r(2," Erro ao carregar dados "),s()())}function me(e,t){if(e&1&&(a(0,"th"),r(1),s()),e&2){let i=t.$implicit;m(),P(i)}}function de(e,t){if(e&1&&(a(0,"td"),r(1),s()),e&2){let i=t.$index,o=c().$implicit,n=c(2);m(),I(" ",n.isAndFormattedDate(o[i])," ")}}function pe(e,t){if(e&1&&(a(0,"tr"),f(1,de,2,1,"td",null,u),s()),e&2){let i=c(2);m(),v(i.alertColumns())}}function ce(e,t){if(e&1&&(a(0,"table",1)(1,"thead")(2,"tr"),f(3,me,2,1,"th",null,u),s()(),a(5,"tbody"),f(6,pe,3,0,"tr",null,u),s()()),e&2){let i=c();m(3),v(i.alertColumns()),m(3),v(i.alertRows())}}var U=class e{overviewStore=p(y);alertColumns=this.overviewStore.alertColumns;alertRows=this.overviewStore.alertRows;state=d(()=>this.overviewStore.alertState().state);dataUtil=k.init();constructor(){this.overviewStore.loadAlerts()}isAndFormattedDate(t){return this.dataUtil.isAndFormattedDate(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=h({type:e,selectors:[["app-alerts"]],standalone:!0,features:[_([]),C],decls:3,vars:1,consts:[[1,"card"],[1,"table","table-striped","table-bordered","mt-3"],[1,"card-body","d-flex","justify-content-center"]],template:function(i,o){if(i&1&&D(0,re,3,0,"div",0)(1,le,3,0,"div",0)(2,ce,8,0,"table",1),i&2){let n;A((n=o.state())==="loading"?0:n==="error"?1:n==="success"?2:-1)}}})};var X=class e{static \u0275fac=function(i){return new(i||e)};static \u0275cmp=h({type:e,selectors:[["app-overview"]],standalone:!0,features:[_([x,y]),C],decls:14,vars:0,consts:[[1,"d-flex","flex-column"],["missionType","pending"],["missionType","finish"]],template:function(i,o){i&1&&(a(0,"h3"),r(1,"Vis\xE3o Geral"),s(),a(2,"div",0)(3,"h4"),r(4,"Movimentos Pendentes"),s(),O(5,"app-missions",1),s(),a(6,"div",0)(7,"h4"),r(8,"\xDAltimas Miss\xF5es - Movimentos Conclu\xEDdos"),s(),O(9,"app-missions",2),s(),a(10,"div",0)(11,"h4"),r(12,"\xDAltimos Alertas"),s(),O(13,"app-alerts"),s())},dependencies:[$,U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})};export{X as OverviewComponent};
