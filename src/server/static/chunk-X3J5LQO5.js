import{a as ue,b as B,c as fe,d as se,e as le,f as R,g as de,h as me,i as pe,m as ce}from"./chunk-SH6EOPS2.js";import{a as ae,b as D}from"./chunk-2YJ3FLSX.js";import{b as re}from"./chunk-ODSXTPVL.js";import{a as te}from"./chunk-BAP55IBU.js";import{a as l,b as ie,d as oe,e as ne}from"./chunk-4IFBPCWC.js";import"./chunk-JLEYIN34.js";import{a as N}from"./chunk-ANSMRTUX.js";import{$a as k,A as F,Ab as Q,Ba as u,Bb as X,D as y,Db as Z,Ja as H,O as E,Oa as M,R as K,Ra as J,Sa as d,Ta as g,Tb as ee,Va as I,Wa as v,X as s,Xa as h,Ya as C,Z as w,Za as n,_a as a,bb as q,cb as c,db as m,ga as V,ha as j,i as x,ib as f,jb as T,kb as W,lb as Y,mb as L,o as G,qa as P,ya as z}from"./chunk-6VFV3J45.js";import{a as U,b as A}from"./chunk-2VMXMS7J.js";var b=class e{http=s(ee);getBufferById(r){return this.http.post(`${N.REST}/buffers/${r}`,{}).pipe(G(t=>t.map(i=>A(U({},i),{idBuffer:r}))))}updateSku(r,t,i){return this.http.post(`${N.REST}/buffers/${r}/update/sku/${t}`,{sku:i})}updateOccupation(r,t,i,o){return this.http.post(`${N.REST}/buffers/${r}/update/position/${i}/${t}`,{occupied:o})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=K({token:e,factory:e.\u0275fac})};var Se={bufferState:{data:null,state:"idle"},skuState:{data:null,state:"idle"},positionState:{data:null,state:"idle"}},_=ie(ne(Se),oe((e,r=s(b),t=s(te))=>({getBufferById(i){l(e,{bufferState:{data:null,state:"loading"}}),r.getBufferById(i).pipe(y(1),E(o=>l(e,{bufferState:{data:o,state:"success"}})),F(o=>(l(e,{bufferState:{data:null,state:"error"}}),t.error(o.message),x))).subscribe()},updateSku(i,o,p,S){l(e,{skuState:{data:null,state:"loading"}}),r.updateSku(i,o,p).pipe(y(1),E(()=>{l(e,{skuState:{data:null,state:"success"}}),S.close(),t.success("Sku alterado com sucesso."),this.getBufferById(i)}),F($=>(l(e,{skuState:{data:null,state:"error"}}),t.error($.message),x))).subscribe()},updateOccupation(i,o,p,S){l(e,{skuState:{data:null,state:"loading"}}),r.updateOccupation(i,o,p,S).pipe(y(1),E(()=>{l(e,{positionState:{data:null,state:"success"}}),t.success("Posi\xE7\xE3o alterada com sucesso."),this.getBufferById(i)}),F($=>(l(e,{positionState:{data:null,state:"error"}}),t.error($.message),x))).subscribe()}})));function ve(e,r){if(e&1&&(n(0,"p"),f(1),a()),e&2){let t=r.$implicit;u(),T(t)}}function he(e,r){e&1&&(n(0,"div",8),k(1,"div",10),n(2,"span"),f(3,"Confirmando..."),a()())}function Ce(e,r){e&1&&(n(0,"span"),f(1,"Confirmar"),a())}var O=class e{modalRef=s(ae);bufferStore=s(_);isLoading=H(!1);bufferForm=new le({idBuffer:new R(void 0,[B.required]),row_id:new R(void 0,[B.required]),sku:new R("",[B.required,B.minLength(3)])});constructor(){let r=this.modalRef.data;this.bufferForm.patchValue({sku:r.sku,row_id:r.row_id,idBuffer:r.idBuffer})}errors(r){return this.bufferForm.get(r)?.errors?Object.keys(this.bufferForm.get(r)?.errors).map(t=>t==="required"?"Campo obrigat\xF3rio":t==="minlength"?`M\xEDnimo de ${this.bufferForm.get(r)?.getError(t).requiredLength}`:t):null}onUpdate(){this.bufferForm.valid&&this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,this.bufferForm.value.sku,this.modalRef)}onClearLine(){this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,null,this.modalRef)}onClose(){this.modalRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-sku-form"]],standalone:!0,features:[L],decls:19,vars:8,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","text","placeholder","sku","formControlName","sku","autocomplete","off",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"form",1)(2,"h5",2),f(3,"SKU"),a(),n(4,"label",3)(5,"span"),f(6,"Sku"),a(),k(7,"input",4),n(8,"div",5),h(9,ve,2,1,"p",null,v),a()(),n(11,"div",6)(12,"button",7),c("click",function(){return i.onUpdate()}),M(13,he,4,0,"div",8)(14,Ce,2,0,"span"),a(),n(15,"button",9),c("click",function(){return i.onClearLine()}),f(16," Limpar Linha "),a(),n(17,"button",9),c("click",function(){return i.onClose()}),f(18," Cancelar "),a()()()()),t&2){let o;u(),d("formGroup",i.bufferForm),u(6),g("is-invalid",((o=i.bufferForm.get("sku"))==null?null:o.touched)&&((o=i.bufferForm.get("sku"))==null?null:o.invalid)),u(2),C(i.errors("sku")),u(3),d("disabled",i.bufferForm.invalid)("disabled",i.isLoading()||i.bufferForm.invalid),u(),I(i.isLoading()?13:14),u(2),d("disabled",i.isLoading()),u(2),d("disabled",i.isLoading())}},dependencies:[ce,de,ue,fe,se,me,pe],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"]})};function ke(e,r){e&1&&(n(0,"tr")(1,"td",3),f(2,"Carregando..."),a()())}function Be(e,r){e&1&&(n(0,"tr")(1,"td",3),f(2,"Erro ao carregar os dados"),a()())}function xe(e,r){if(e&1){let t=q();n(0,"button",5),c("click",function(){let o=V(t).$implicit,p=m().$implicit,S=m(2);return j(S.onUpdateOccupation(p,o))}),k(1,"img",8),a()}if(e&2){let t=r.$implicit,i=m().$implicit,o=m(2);g("border-0",o.isNotLogged()),d("disabled",o.isNotLogged()),u(),d("src","static/icons/"+i.type+".png",z),J("data-occupied",t.occupied)}}function Fe(e,r){if(e&1){let t=q();n(0,"tr")(1,"td",4)(2,"button",5),c("click",function(){let o=V(t).$implicit,p=m(2);return j(p.onOpenSkuForm(o))}),f(3),a()(),n(4,"td")(5,"div",6),h(6,xe,2,5,"button",7,v),a()()()}if(e&2){let t=r.$implicit,i=m(2);u(2),g("border-0",i.isNotLogged()),d("disabled",i.isNotLogged()),u(),W(" ",t.sku||"LIVRE"," "),u(3),C(t.positions)}}function ye(e,r){e&1&&(n(0,"tr")(1,"td",3),f(2,"Sem registros"),a()())}function Ee(e,r){if(e&1&&h(0,Fe,8,4,"tr",null,v,!1,ye,3,0,"tr"),e&2){let t=m();C(t.bufferState().data)}}function we(e){return e?e.replace("-"," "):""}var _e=class e{bufferName=P("Buffer",{alias:"name",transform:we});bufferId=P(0,{alias:"id",transform:Q});bufferStore=s(_);modalService=s(D);authService=s(re);bufferState=this.bufferStore.bufferState;isNotLogged=X(()=>!this.authService.isLogged());constructor(){Z(()=>{this.bufferId()&&this.loadBufferById()},{allowSignalWrites:!0})}loadBufferById(){this.bufferStore.getBufferById(this.bufferId())}onOpenSkuForm(r){this.isNotLogged()||this.modalService.open(O,!0,r,[{provide:_,useValue:this.bufferStore}])}onUpdateOccupation(r,t){this.isNotLogged()||this.bufferStore.updateOccupation(r.idBuffer,t.pos,r.row_id,!t.occupied)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-buffer"]],inputs:{bufferName:[1,"name","bufferName"],bufferId:[1,"id","bufferId"]},standalone:!0,features:[Y([b,_,D]),L],decls:14,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center"],[1,"table","table-striped"],[1,"w-25",2,"min-width","fit-content"],["colspan","2",1,"text-center"],[1,"text-center"],[1,"btn",3,"click","disabled"],[1,"d-flex","gap-1"],[1,"btn",3,"border-0","disabled"],["height","30",1,"bobina_pallet",3,"src"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"h3"),f(2),a()(),n(3,"table",1)(4,"thead")(5,"tr")(6,"th",2),f(7,"SKU"),a(),n(8,"th"),f(9,"Ocupa\xE7\xE3o"),a()()(),n(10,"tbody"),M(11,ke,3,0,"tr")(12,Be,3,0,"tr")(13,Ee,3,1),a()()),t&2){let o;u(2),T(i.bufferName()),u(9),I((o=i.bufferState().state)==="loading"?11:o==="error"?12:o==="success"?13:-1)}},styles:[".bobina_pallet[data-occupied=true][_ngcontent-%COMP%]{filter:invert(22%) sepia(75%) saturate(6197%) hue-rotate(119deg) brightness(95%) contrast(101%)}"]})};export{_e as BufferComponent};
