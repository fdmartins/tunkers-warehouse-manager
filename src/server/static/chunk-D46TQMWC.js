import{a as pe,b as F,c as ce,d as be,e as _e,f as D,g as Se,h as ge,i as ve,m as he}from"./chunk-SH6EOPS2.js";import{a as me,b as A}from"./chunk-2YJ3FLSX.js";import{b as ue}from"./chunk-JLQCEZVO.js";import{a as se}from"./chunk-BAP55IBU.js";import{a as d,b as le,d as fe,e as de}from"./chunk-4IFBPCWC.js";import"./chunk-JLEYIN34.js";import{a as O}from"./chunk-LZOUE64L.js";import{$a as B,A as R,Ab as ie,Ba as u,Bb as ne,D as h,Db as oe,Ja as ee,M as Q,O as b,Oa as I,R as X,Ra as te,Sa as m,Ta as C,Tb as ae,Va as T,Wa as x,X as l,Xa as k,Ya as y,Z as w,Za as o,_a as a,b as H,bb as U,cb as c,db as p,ga as P,ha as V,i as E,ib as s,jb as L,kb as N,la as M,lb as re,mb as $,o as J,qa as j,w as W,y as Y,ya as Z}from"./chunk-6VFV3J45.js";import{a as z,b as K}from"./chunk-2VMXMS7J.js";var _=class e{http=l(ae);getBufferById(r){return this.http.post(`${O.REST}/buffers/${r}`,{}).pipe(J(t=>t.map(i=>K(z({},i),{idBuffer:r}))))}updateSku(r,t,i){return this.http.post(`${O.REST}/buffers/${r}/update/sku/${t}`,{sku:i})}updateOccupation(r,t,i,n){return this.http.post(`${O.REST}/buffers/${r}/update/position/${i}/${t}`,{occupied:n})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=X({token:e,factory:e.\u0275fac})};var Be={data:null,state:"idle",pesquisando:!1,skuState:{data:null,state:"idle"},positionState:{data:null,state:"idle"}},xe=new H,S=le(de(Be),fe((e,r=l(_),t=l(se))=>({getBufferById(i,n){xe.unsubscribe(),xe=W(0,2e3).pipe(h(1),Y(()=>!e.pesquisando()),b(()=>d(e,{pesquisando:!0})),Q(()=>r.getBufferById(i).pipe(h(1),b(f=>d(e,{data:f,state:"success"})),R(f=>(d(e,{data:null,state:"error"}),t.error(f.message),E)))),b(()=>d(e,{pesquisando:!1}))).subscribe()},updateSku(i,n,f,g,v,G=null){d(e,{skuState:{data:null,state:"loading"}}),r.updateSku(i,n,f).pipe(h(1),b(()=>{d(e,{skuState:{data:null,state:"success"}}),g.close(),t.success("Sku alterado com sucesso."),this.getBufferById(i,v)}),R(ye=>(d(e,{skuState:{data:null,state:"error"}}),t.error(ye.message),E))).subscribe()},updateOccupation(i,n,f,g,v){d(e,{skuState:{data:null,state:"loading"}}),r.updateOccupation(i,n,f,g).pipe(h(1),b(()=>{d(e,{positionState:{data:null,state:"success"}}),t.success("Posi\xE7\xE3o alterada com sucesso."),this.getBufferById(i,v)}),R(G=>(d(e,{positionState:{data:null,state:"error"}}),t.error(G.message),E))).subscribe()}})));function Ee(e,r){if(e&1&&(o(0,"p"),s(1),a()),e&2){let t=r.$implicit;u(),L(t)}}function Re(e,r){e&1&&(o(0,"div",8),B(1,"div",10),o(2,"span"),s(3,"Confirmando..."),a()())}function we(e,r){e&1&&(o(0,"span"),s(1,"Confirmar"),a())}var q=class e{modalRef=l(me);bufferStore=l(S);destroyRef=l(M);isLoading=ee(!1);bufferForm=new _e({idBuffer:new D(void 0,[F.required]),row_id:new D(void 0,[F.required]),sku:new D("",[F.required,F.minLength(3)])});constructor(){let r=this.modalRef.data;this.bufferForm.patchValue({sku:r.sku,row_id:r.row_id,idBuffer:r.idBuffer})}errors(r){return this.bufferForm.get(r)?.errors?Object.keys(this.bufferForm.get(r)?.errors).map(t=>t==="required"?"Campo obrigat\xF3rio":t==="minlength"?`M\xEDnimo de ${this.bufferForm.get(r)?.getError(t).requiredLength}`:t):null}onUpdate(){this.bufferForm.valid&&this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,this.bufferForm.value.sku,this.modalRef,this.destroyRef)}onClearLine(){this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,null,this.modalRef,this.destroyRef)}onClose(){this.modalRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-sku-form"]],standalone:!0,features:[$],decls:19,vars:8,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","text","placeholder","sku","formControlName","sku","autocomplete","off",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(t,i){if(t&1&&(o(0,"div",0)(1,"form",1)(2,"h5",2),s(3,"SKU"),a(),o(4,"label",3)(5,"span"),s(6,"Sku"),a(),B(7,"input",4),o(8,"div",5),k(9,Ee,2,1,"p",null,x),a()(),o(11,"div",6)(12,"button",7),c("click",function(){return i.onUpdate()}),I(13,Re,4,0,"div",8)(14,we,2,0,"span"),a(),o(15,"button",9),c("click",function(){return i.onClearLine()}),s(16," Limpar Linha "),a(),o(17,"button",9),c("click",function(){return i.onClose()}),s(18," Cancelar "),a()()()()),t&2){let n;u(),m("formGroup",i.bufferForm),u(6),C("is-invalid",((n=i.bufferForm.get("sku"))==null?null:n.touched)&&((n=i.bufferForm.get("sku"))==null?null:n.invalid)),u(2),y(i.errors("sku")),u(3),m("disabled",i.bufferForm.invalid)("disabled",i.isLoading()||i.bufferForm.invalid),u(),T(i.isLoading()?13:14),u(2),m("disabled",i.isLoading()),u(2),m("disabled",i.isLoading())}},dependencies:[he,Se,pe,ce,be,ge,ve],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"]})};function Me(e,r){e&1&&(o(0,"tr")(1,"td",4),s(2,"Carregando..."),a()())}function Ie(e,r){e&1&&(o(0,"tr")(1,"td",4),s(2,"Erro ao carregar os dados"),a()())}function Te(e,r){if(e&1){let t=U();o(0,"button",9),c("click",function(n){let f=P(t).$implicit,g=p().$implicit,v=p(2);return V(v.onUpdateOccupation(g,f,n))}),B(1,"img",10),o(2,"div",11),s(3),a()()}if(e&2){let t=r.$implicit,i=p().$implicit,n=p(2);C("border-0",n.isNotLogged()),m("disabled",n.isNotLogged()),u(),m("src","static/icons/"+i.type+".png",Z),te("data-occupied",t.occupied),u(2),N(" ",t.pos," ")}}function Le(e,r){if(e&1){let t=U();o(0,"tr")(1,"td",5),s(2),a(),o(3,"td",5)(4,"button",6),c("click",function(){let n=P(t).$implicit,f=p(2);return V(f.onOpenSkuForm(n))}),s(5),a()(),o(6,"td")(7,"div",7),k(8,Te,4,6,"button",8,x),a()()()}if(e&2){let t=r.$implicit,i=r.$index,n=p(2);u(2),N(" ",i+1," "),u(2),C("border-0",n.isNotLogged()),m("disabled",n.isNotLogged()),u(),N(" ",t.sku||"LIVRE"," "),u(3),y(t.positions)}}function Ne(e,r){e&1&&(o(0,"tr")(1,"td",4),s(2,"Sem registros"),a()())}function $e(e,r){if(e&1&&k(0,Le,10,5,"tr",null,x,!1,Ne,3,0,"tr"),e&2){let t=p();y(t.data())}}function Oe(e){return e?e.replace("-"," "):""}var ke=class e{bufferName=j("Buffer",{alias:"name",transform:Oe});bufferId=j(0,{alias:"id",transform:ie});bufferStore=l(S);modalService=l(A);authService=l(ue);destroyRef=l(M);data=this.bufferStore.data;state=this.bufferStore.state;isNotLogged=ne(()=>!this.authService.isLogged());constructor(){oe(()=>{this.bufferId()&&this.loadBufferById()},{allowSignalWrites:!0})}loadBufferById(){this.bufferStore.getBufferById(this.bufferId(),this.destroyRef)}onOpenSkuForm(r){this.isNotLogged()||this.modalService.open(q,!0,r,[{provide:S,useValue:this.bufferStore}])}onUpdateOccupation(r,t,i){this.isNotLogged()||this.bufferStore.updateOccupation(r.idBuffer,t.pos,r.row_id,!t.occupied,this.destroyRef),i.preventDefault(),i.stopPropagation()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-buffer"]],inputs:{bufferName:[1,"name","bufferName"],bufferId:[1,"id","bufferId"]},standalone:!0,features:[re([_,S,A]),$],decls:16,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center"],[1,"table","table-striped"],[1,"whitespace-nowrap"],[2,"min-width","fit-content"],["colspan","2",1,"text-center"],[1,"text-center"],[1,"btn",3,"click","disabled"],[1,"d-flex","gap-1"],[1,"btn","d-flex","flex-column","align-items-center",3,"border-0","disabled"],[1,"btn","d-flex","flex-column","align-items-center",3,"click","disabled"],["height","30",1,"bobina_pallet",3,"src"],[2,"font-size","11px","color","#1b1b1b"]],template:function(t,i){if(t&1&&(o(0,"div",0)(1,"h3"),s(2),a()(),o(3,"table",1)(4,"thead")(5,"tr")(6,"th",2),s(7,"Rua"),a(),o(8,"th",3),s(9,"SKU"),a(),o(10,"th"),s(11,"Ocupa\xE7\xE3o"),a()()(),o(12,"tbody"),I(13,Me,3,0,"tr")(14,Ie,3,0,"tr")(15,$e,3,1),a()()),t&2){let n;u(2),L(i.bufferName()),u(11),T((n=i.state())==="loading"?13:n==="error"?14:n==="success"?15:-1)}},styles:[".bobina_pallet[data-occupied=true][_ngcontent-%COMP%]{filter:invert(22%) sepia(75%) saturate(6197%) hue-rotate(125deg) brightness(95%) contrast(1151%)}.bobina_pallet[data-occupied=false][_ngcontent-%COMP%]{filter:invert(22%) sepia(15%) saturate(67%) hue-rotate(339deg) brightness(15%) contrast(11%)}"]})};export{ke as BufferComponent};
