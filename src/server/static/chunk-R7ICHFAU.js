import{a as ue,b as B,c as se,d as fe,e as le,f as R,g as de,h as me,i as pe,m as ce}from"./chunk-SH6EOPS2.js";import{a as ae,b as D}from"./chunk-2YJ3FLSX.js";import{b as re}from"./chunk-ODSXTPVL.js";import{a as te}from"./chunk-BAP55IBU.js";import{a as l,b as ie,d as ne,e as oe}from"./chunk-4IFBPCWC.js";import"./chunk-JLEYIN34.js";import{a as N}from"./chunk-ANSMRTUX.js";import{$a as k,A as y,Ab as Q,Ba as u,Bb as X,D as E,Db as Z,Ja as H,O as w,Oa as I,R as z,Ra as J,Sa as d,Ta as g,Tb as ee,Va as T,Wa as v,X as f,Xa as h,Ya as C,Z as M,Za as o,_a as a,bb as q,cb as c,db as m,ga as V,ha as P,i as F,ib as s,jb as x,kb as W,lb as Y,mb as L,o as G,qa as j,ya as K}from"./chunk-6VFV3J45.js";import{a as U,b as A}from"./chunk-2VMXMS7J.js";var b=class t{http=f(ee);getBufferById(r){return this.http.post(`${N.REST}/buffers/${r}`,{}).pipe(G(e=>e.map(i=>A(U({},i),{idBuffer:r}))))}updateSku(r,e,i){return this.http.post(`${N.REST}/buffers/${r}/update/sku/${e}`,{sku:i})}updateOccupation(r,e,i,n){return this.http.post(`${N.REST}/buffers/${r}/update/position/${i}/${e}`,{occupied:n})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=z({token:t,factory:t.\u0275fac})};var Se={bufferState:{data:null,state:"idle"},skuState:{data:null,state:"idle"},positionState:{data:null,state:"idle"}},_=ie(oe(Se),ne((t,r=f(b),e=f(te))=>({getBufferById(i){l(t,{bufferState:{data:null,state:"loading"}}),r.getBufferById(i).pipe(E(1),w(n=>l(t,{bufferState:{data:n,state:"success"}})),y(n=>(l(t,{bufferState:{data:null,state:"error"}}),e.error(n.message),F))).subscribe()},updateSku(i,n,p,S){l(t,{skuState:{data:null,state:"loading"}}),r.updateSku(i,n,p).pipe(E(1),w(()=>{l(t,{skuState:{data:null,state:"success"}}),S.close(),e.success("Sku alterado com sucesso."),this.getBufferById(i)}),y($=>(l(t,{skuState:{data:null,state:"error"}}),e.error($.message),F))).subscribe()},updateOccupation(i,n,p,S){l(t,{skuState:{data:null,state:"loading"}}),r.updateOccupation(i,n,p,S).pipe(E(1),w(()=>{l(t,{positionState:{data:null,state:"success"}}),e.success("Posi\xE7\xE3o alterada com sucesso."),this.getBufferById(i)}),y($=>(l(t,{positionState:{data:null,state:"error"}}),e.error($.message),F))).subscribe()}})));function ve(t,r){if(t&1&&(o(0,"p"),s(1),a()),t&2){let e=r.$implicit;u(),x(e)}}function he(t,r){t&1&&(o(0,"div",8),k(1,"div",10),o(2,"span"),s(3,"Confirmando..."),a()())}function Ce(t,r){t&1&&(o(0,"span"),s(1,"Confirmar"),a())}var O=class t{modalRef=f(ae);bufferStore=f(_);isLoading=H(!1);bufferForm=new le({idBuffer:new R(void 0,[B.required]),row_id:new R(void 0,[B.required]),sku:new R("",[B.required,B.minLength(3)])});constructor(){let r=this.modalRef.data;this.bufferForm.patchValue({sku:r.sku,row_id:r.row_id,idBuffer:r.idBuffer})}errors(r){return this.bufferForm.get(r)?.errors?Object.keys(this.bufferForm.get(r)?.errors).map(e=>e==="required"?"Campo obrigat\xF3rio":e==="minlength"?`M\xEDnimo de ${this.bufferForm.get(r)?.getError(e).requiredLength}`:e):null}onUpdate(){this.bufferForm.valid&&this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,this.bufferForm.value.sku,this.modalRef)}onClearLine(){this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,null,this.modalRef)}onClose(){this.modalRef.close()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-sku-form"]],standalone:!0,features:[L],decls:19,vars:8,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","text","placeholder","sku","formControlName","sku","autocomplete","off",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(e,i){if(e&1&&(o(0,"div",0)(1,"form",1)(2,"h5",2),s(3,"SKU"),a(),o(4,"label",3)(5,"span"),s(6,"Sku"),a(),k(7,"input",4),o(8,"div",5),h(9,ve,2,1,"p",null,v),a()(),o(11,"div",6)(12,"button",7),c("click",function(){return i.onUpdate()}),I(13,he,4,0,"div",8)(14,Ce,2,0,"span"),a(),o(15,"button",9),c("click",function(){return i.onClearLine()}),s(16," Limpar Linha "),a(),o(17,"button",9),c("click",function(){return i.onClose()}),s(18," Cancelar "),a()()()()),e&2){let n;u(),d("formGroup",i.bufferForm),u(6),g("is-invalid",((n=i.bufferForm.get("sku"))==null?null:n.touched)&&((n=i.bufferForm.get("sku"))==null?null:n.invalid)),u(2),C(i.errors("sku")),u(3),d("disabled",i.bufferForm.invalid)("disabled",i.isLoading()||i.bufferForm.invalid),u(),T(i.isLoading()?13:14),u(2),d("disabled",i.isLoading()),u(2),d("disabled",i.isLoading())}},dependencies:[ce,de,ue,se,fe,me,pe],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"]})};function ke(t,r){t&1&&(o(0,"tr")(1,"td",3),s(2,"Carregando..."),a()())}function xe(t,r){t&1&&(o(0,"tr")(1,"td",3),s(2,"Erro ao carregar os dados"),a()())}function Be(t,r){if(t&1){let e=q();o(0,"button",8),c("click",function(){let n=V(e).$implicit,p=m().$implicit,S=m(2);return P(S.onUpdateOccupation(p,n))}),k(1,"img",9),o(2,"div",10),s(3),a()()}if(t&2){let e=r.$implicit,i=m().$implicit,n=m(2);g("border-0",n.isNotLogged()),d("disabled",n.isNotLogged()),u(),d("src","static/icons/"+i.type+".png",K),J("data-occupied",e.occupied),u(2),x(e.pos)}}function Fe(t,r){if(t&1){let e=q();o(0,"tr")(1,"td",4)(2,"button",5),c("click",function(){let n=V(e).$implicit,p=m(2);return P(p.onOpenSkuForm(n))}),s(3),a()(),o(4,"td")(5,"div",6),h(6,Be,4,6,"button",7,v),a()()()}if(t&2){let e=r.$implicit,i=m(2);u(2),g("border-0",i.isNotLogged()),d("disabled",i.isNotLogged()),u(),W(" ",e.sku||"LIVRE"," "),u(3),C(e.positions)}}function ye(t,r){t&1&&(o(0,"tr")(1,"td",3),s(2,"Sem registros"),a()())}function Ee(t,r){if(t&1&&h(0,Fe,8,4,"tr",null,v,!1,ye,3,0,"tr"),t&2){let e=m();C(e.bufferState().data)}}function we(t){return t?t.replace("-"," "):""}var _e=class t{bufferName=j("Buffer",{alias:"name",transform:we});bufferId=j(0,{alias:"id",transform:Q});bufferStore=f(_);modalService=f(D);authService=f(re);bufferState=this.bufferStore.bufferState;isNotLogged=X(()=>!this.authService.isLogged());constructor(){Z(()=>{this.bufferId()&&this.loadBufferById()},{allowSignalWrites:!0})}loadBufferById(){this.bufferStore.getBufferById(this.bufferId())}onOpenSkuForm(r){this.isNotLogged()||this.modalService.open(O,!0,r,[{provide:_,useValue:this.bufferStore}])}onUpdateOccupation(r,e){this.isNotLogged()||this.bufferStore.updateOccupation(r.idBuffer,e.pos,r.row_id,!e.occupied)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-buffer"]],inputs:{bufferName:[1,"name","bufferName"],bufferId:[1,"id","bufferId"]},standalone:!0,features:[Y([b,_,D]),L],decls:14,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center"],[1,"table","table-striped"],[1,"w-25",2,"min-width","fit-content"],["colspan","2",1,"text-center"],[1,"text-center"],[1,"btn",3,"click","disabled"],[1,"d-flex","gap-1"],[1,"btn","d-flex","flex-column","align-items-center",3,"border-0","disabled"],[1,"btn","d-flex","flex-column","align-items-center",3,"click","disabled"],["height","30",1,"bobina_pallet",3,"src"],[2,"font-size","10px","color","#333"]],template:function(e,i){if(e&1&&(o(0,"div",0)(1,"h3"),s(2),a()(),o(3,"table",1)(4,"thead")(5,"tr")(6,"th",2),s(7,"SKU"),a(),o(8,"th"),s(9,"Ocupa\xE7\xE3o"),a()()(),o(10,"tbody"),I(11,ke,3,0,"tr")(12,xe,3,0,"tr")(13,Ee,3,1),a()()),e&2){let n;u(2),x(i.bufferName()),u(9),T((n=i.bufferState().state)==="loading"?11:n==="error"?12:n==="success"?13:-1)}},styles:[".bobina_pallet[data-occupied=true][_ngcontent-%COMP%]{filter:invert(22%) sepia(75%) saturate(6197%) hue-rotate(125deg) brightness(95%) contrast(1151%)}.bobina_pallet[data-occupied=false][_ngcontent-%COMP%]{filter:invert(22%) sepia(15%) saturate(67%) hue-rotate(339deg) brightness(15%) contrast(11%)}"]})};export{_e as BufferComponent};
