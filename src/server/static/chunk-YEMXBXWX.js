import{a as pe,b as F,c as ce,d as be,e as _e,f as $,g as ge,h as Se,i as ve,m as he}from"./chunk-SH6EOPS2.js";import{a as me,b as A}from"./chunk-2YJ3FLSX.js";import{b as ue}from"./chunk-JLQCEZVO.js";import{a as se}from"./chunk-BAP55IBU.js";import{a as d,b as le,d as fe,e as de}from"./chunk-4IFBPCWC.js";import"./chunk-JLEYIN34.js";import{a as O}from"./chunk-LZOUE64L.js";import{$a as B,A as R,Ab as ie,Ba as s,Bb as oe,D as h,Db as ne,Ja as ee,M as Q,O as b,Oa as I,R as X,Ra as te,Sa as m,Ta as C,Tb as ae,Va as T,Wa as k,X as l,Xa as x,Ya as y,Z as w,Za as n,_a as a,b as H,bb as j,cb as c,db as p,ga as q,ha as P,i as E,ib as u,jb as L,kb as U,la as M,lb as re,mb as N,o as J,qa as V,w as W,y as Y,ya as Z}from"./chunk-6VFV3J45.js";import{a as z,b as K}from"./chunk-2VMXMS7J.js";var _=class e{http=l(ae);getBufferById(r){return this.http.post(`${O.REST}/buffers/${r}`,{}).pipe(J(t=>t.map(i=>K(z({},i),{idBuffer:r}))))}updateSku(r,t,i){return this.http.post(`${O.REST}/buffers/${r}/update/sku/${t}`,{sku:i})}updateOccupation(r,t,i,o){return this.http.post(`${O.REST}/buffers/${r}/update/position/${i}/${t}`,{occupied:o})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=X({token:e,factory:e.\u0275fac})};var Be={data:null,state:"idle",pesquisando:!1,skuState:{data:null,state:"idle"},positionState:{data:null,state:"idle"}},ke=new H,g=le(de(Be),fe((e,r=l(_),t=l(se))=>({getBufferById(i,o){ke.unsubscribe(),ke=W(0,2e3).pipe(h(1),Y(()=>!e.pesquisando()),b(()=>d(e,{pesquisando:!0})),Q(()=>r.getBufferById(i).pipe(h(1),b(f=>d(e,{data:f,state:"success"})),R(f=>(d(e,{data:null,state:"error"}),t.error(f.message),E)))),b(()=>d(e,{pesquisando:!1}))).subscribe()},updateSku(i,o,f,S,v,G=null){d(e,{skuState:{data:null,state:"loading"}}),r.updateSku(i,o,f).pipe(h(1),b(()=>{d(e,{skuState:{data:null,state:"success"}}),S.close(),t.success("Sku alterado com sucesso."),this.getBufferById(i,v)}),R(ye=>(d(e,{skuState:{data:null,state:"error"}}),t.error(ye.message),E))).subscribe()},updateOccupation(i,o,f,S,v){d(e,{skuState:{data:null,state:"loading"}}),r.updateOccupation(i,o,f,S).pipe(h(1),b(()=>{d(e,{positionState:{data:null,state:"success"}}),t.success("Posi\xE7\xE3o alterada com sucesso."),this.getBufferById(i,v)}),R(G=>(d(e,{positionState:{data:null,state:"error"}}),t.error(G.message),E))).subscribe()}})));function Ee(e,r){if(e&1&&(n(0,"p"),u(1),a()),e&2){let t=r.$implicit;s(),L(t)}}function Re(e,r){e&1&&(n(0,"div",8),B(1,"div",10),n(2,"span"),u(3,"Confirmando..."),a()())}function we(e,r){e&1&&(n(0,"span"),u(1,"Confirmar"),a())}var D=class e{modalRef=l(me);bufferStore=l(g);destroyRef=l(M);isLoading=ee(!1);bufferForm=new _e({idBuffer:new $(void 0,[F.required]),row_id:new $(void 0,[F.required]),sku:new $("",[F.required,F.minLength(3)])});constructor(){let r=this.modalRef.data;this.bufferForm.patchValue({sku:r.sku,row_id:r.row_id,idBuffer:r.idBuffer})}errors(r){return this.bufferForm.get(r)?.errors?Object.keys(this.bufferForm.get(r)?.errors).map(t=>t==="required"?"Campo obrigat\xF3rio":t==="minlength"?`M\xEDnimo de ${this.bufferForm.get(r)?.getError(t).requiredLength}`:t):null}onUpdate(){this.bufferForm.valid&&this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,this.bufferForm.value.sku,this.modalRef,this.destroyRef)}onClearLine(){this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,null,this.modalRef,this.destroyRef)}onClose(){this.modalRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-sku-form"]],standalone:!0,features:[N],decls:19,vars:8,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","text","placeholder","sku","formControlName","sku","autocomplete","off",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"form",1)(2,"h5",2),u(3,"SKU"),a(),n(4,"label",3)(5,"span"),u(6,"Sku"),a(),B(7,"input",4),n(8,"div",5),x(9,Ee,2,1,"p",null,k),a()(),n(11,"div",6)(12,"button",7),c("click",function(){return i.onUpdate()}),I(13,Re,4,0,"div",8)(14,we,2,0,"span"),a(),n(15,"button",9),c("click",function(){return i.onClearLine()}),u(16," Limpar Linha "),a(),n(17,"button",9),c("click",function(){return i.onClose()}),u(18," Cancelar "),a()()()()),t&2){let o;s(),m("formGroup",i.bufferForm),s(6),C("is-invalid",((o=i.bufferForm.get("sku"))==null?null:o.touched)&&((o=i.bufferForm.get("sku"))==null?null:o.invalid)),s(2),y(i.errors("sku")),s(3),m("disabled",i.bufferForm.invalid)("disabled",i.isLoading()||i.bufferForm.invalid),s(),T(i.isLoading()?13:14),s(2),m("disabled",i.isLoading()),s(2),m("disabled",i.isLoading())}},dependencies:[he,ge,pe,ce,be,Se,ve],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"]})};function Me(e,r){e&1&&(n(0,"tr")(1,"td",3),u(2,"Carregando..."),a()())}function Ie(e,r){e&1&&(n(0,"tr")(1,"td",3),u(2,"Erro ao carregar os dados"),a()())}function Te(e,r){if(e&1){let t=j();n(0,"button",8),c("click",function(o){let f=q(t).$implicit,S=p().$implicit,v=p(2);return P(v.onUpdateOccupation(S,f,o))}),B(1,"img",9),n(2,"div",10),u(3),a()()}if(e&2){let t=r.$implicit,i=p().$implicit,o=p(2);C("border-0",o.isNotLogged()),m("disabled",o.isNotLogged()),s(),m("src","static/icons/"+i.type+".png",Z),te("data-occupied",t.occupied),s(2),U(" ",t.pos," ")}}function Le(e,r){if(e&1){let t=j();n(0,"tr")(1,"td",4)(2,"button",5),c("click",function(){let o=q(t).$implicit,f=p(2);return P(f.onOpenSkuForm(o))}),u(3),a()(),n(4,"td")(5,"div",6),x(6,Te,4,6,"button",7,k),a()()()}if(e&2){let t=r.$implicit,i=p(2);s(2),C("border-0",i.isNotLogged()),m("disabled",i.isNotLogged()),s(),U(" ",t.sku||"LIVRE"," "),s(3),y(t.positions)}}function Ne(e,r){e&1&&(n(0,"tr")(1,"td",3),u(2,"Sem registros"),a()())}function Oe(e,r){if(e&1&&x(0,Le,8,4,"tr",null,k,!1,Ne,3,0,"tr"),e&2){let t=p();y(t.data())}}function $e(e){return e?e.replace("-"," "):""}var xe=class e{bufferName=V("Buffer",{alias:"name",transform:$e});bufferId=V(0,{alias:"id",transform:ie});bufferStore=l(g);modalService=l(A);authService=l(ue);destroyRef=l(M);data=this.bufferStore.data;state=this.bufferStore.state;isNotLogged=oe(()=>!this.authService.isLogged());constructor(){ne(()=>{this.bufferId()&&this.loadBufferById()},{allowSignalWrites:!0})}loadBufferById(){this.bufferStore.getBufferById(this.bufferId(),this.destroyRef)}onOpenSkuForm(r){this.isNotLogged()||this.modalService.open(D,!0,r,[{provide:g,useValue:this.bufferStore}])}onUpdateOccupation(r,t,i){this.isNotLogged()||this.bufferStore.updateOccupation(r.idBuffer,t.pos,r.row_id,!t.occupied,this.destroyRef),i.preventDefault(),i.stopPropagation()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-buffer"]],inputs:{bufferName:[1,"name","bufferName"],bufferId:[1,"id","bufferId"]},standalone:!0,features:[re([_,g,A]),N],decls:14,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center"],[1,"table","table-striped"],[1,"w-25",2,"min-width","fit-content"],["colspan","2",1,"text-center"],[1,"text-center"],[1,"btn",3,"click","disabled"],[1,"d-flex","gap-1"],[1,"btn","d-flex","flex-column","align-items-center",3,"border-0","disabled"],[1,"btn","d-flex","flex-column","align-items-center",3,"click","disabled"],["height","30",1,"bobina_pallet",3,"src"],[2,"font-size","11px","color","#1b1b1b"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"h3"),u(2),a()(),n(3,"table",1)(4,"thead")(5,"tr")(6,"th",2),u(7,"SKU"),a(),n(8,"th"),u(9,"Ocupa\xE7\xE3o"),a()()(),n(10,"tbody"),I(11,Me,3,0,"tr")(12,Ie,3,0,"tr")(13,Oe,3,1),a()()),t&2){let o;s(2),L(i.bufferName()),s(9),T((o=i.state())==="loading"?11:o==="error"?12:o==="success"?13:-1)}},styles:[".bobina_pallet[data-occupied=true][_ngcontent-%COMP%]{filter:invert(22%) sepia(75%) saturate(6197%) hue-rotate(125deg) brightness(95%) contrast(1151%)}.bobina_pallet[data-occupied=false][_ngcontent-%COMP%]{filter:invert(22%) sepia(15%) saturate(67%) hue-rotate(339deg) brightness(15%) contrast(11%)}"]})};export{xe as BufferComponent};
