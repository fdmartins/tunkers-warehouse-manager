import{a as A,b as u,c as D,d as O,e as q,f as w,g as I,h as j,i as V,j as pe,k as ue,l as ce,m as $}from"./chunk-SH6EOPS2.js";import{a as N,b as Z}from"./chunk-2YJ3FLSX.js";import{b as se}from"./chunk-JLQCEZVO.js";import{a as ne}from"./chunk-BAP55IBU.js";import{a as f,b as le,d as de,e as me}from"./chunk-4IFBPCWC.js";import{d as ae}from"./chunk-JLEYIN34.js";import{a as L}from"./chunk-LZOUE64L.js";import{$a as m,A as Y,Ba as l,Bb as F,D as z,Db as M,O as R,Oa as g,R as ie,Sa as h,Ta as P,Tb as oe,Va as S,Wa as E,X as d,Xa as _,Ya as b,Z as U,Za as i,_a as o,bb as W,cb as c,db as T,ga as J,ha as K,i as H,ib as n,jb as C,lb as k,mb as x,o as re,qa as Q,zb as X}from"./chunk-6VFV3J45.js";import{a as te}from"./chunk-2VMXMS7J.js";var y=class e{http=d(oe);list(){return this.http.get(`${L.REST}/users/list`).pipe(re(r=>r.users))}create(r){return this.http.post(`${L.REST}/users/create`,r)}updatePassword(r){return this.http.post(`${L.REST}/users/update/password`,r)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=ie({token:e,factory:e.\u0275fac})};var he={usersList:{state:"idle",data:[]},createState:{state:"idle",data:null},updatePasswordState:{state:"idle",data:null}},v=le(me(he),de((e,r=d(y),t=d(ne))=>({list(){f(e,{usersList:{data:[],state:"loading"}}),r.list().pipe(R(a=>{f(e,{usersList:{data:a,state:"success"}})})).subscribe()},create(a,s){f(e,{createState:{data:null,state:"loading"}}),r.create(a).pipe(z(1),R(()=>{f(e,{createState:{data:null,state:"success"}}),s.close(),t.success("Usu\xE1rio cadastrado com sucesso"),this.list()}),Y(p=>(f(e,{createState:{data:null,state:"error"}}),t.error(p.message),H))).subscribe()},updatePassword(a,s){f(e,{updatePasswordState:{data:null,state:"loading"}}),r.updatePassword(a).pipe(z(1),R(()=>{f(e,{updatePasswordState:{data:null,state:"success"}}),s.close(),t.success("Senha alterada com sucesso."),this.list()}),Y(p=>(f(e,{updatePasswordState:{data:null,state:"error"}}),t.error(p.message),H))).subscribe()}})));function ge(e,r){if(e&1&&(i(0,"p"),n(1),o()),e&2){let t=r.$implicit;l(),C(t)}}function Se(e,r){if(e&1&&(i(0,"p"),n(1),o()),e&2){let t=r.$implicit;l(),C(t)}}function _e(e,r){e&1&&(i(0,"div",12),m(1,"div",14),i(2,"span"),n(3,"Cadastrando..."),o()())}function be(e,r){e&1&&(i(0,"span"),n(1,"Cadastrar"),o())}var G=class e{modalRef=d(N);userStore=d(v);isLoading=F(()=>this.userStore.createState().state==="loading");userForm=new q({username:new w("",[u.required,u.minLength(6)]),password:new w("",[u.required,u.minLength(6)]),roles:new w("OPERADOR",[u.required])});constructor(){M(()=>{this.isLoading()?this.userForm.disable():this.userForm.enable()})}errors(r){return this.userForm.get(r)?.errors?Object.keys(this.userForm.get(r)?.errors).map(t=>t==="required"?"Campo obrigat\xF3rio":t==="minlength"?`M\xEDnimo de ${this.userForm.get(r)?.getError(t).requiredLength}`:t):null}onCreate(){this.userForm.valid&&this.userStore.create(te({},this.userForm.value),this.modalRef)}onClose(){this.modalRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=U({type:e,selectors:[["app-user-form"]],standalone:!0,features:[k([]),x],decls:32,vars:9,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","text","formControlName","username","placeholder","login",1,"form-control"],[1,"invalid-feedback"],["type","password","placeholder","senha","formControlName","password","autocomplete","off",1,"form-control"],["aria-label","Default select example","formControlName","roles",1,"form-select"],["value","OPERADOR"],["value","ADMIN"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(t,a){if(t&1&&(i(0,"div",0)(1,"form",1)(2,"h5",2),n(3,"Criar Novo Usu\xE1rio"),o(),i(4,"label",3)(5,"span"),n(6,"Login"),o(),m(7,"input",4),i(8,"div",5),_(9,ge,2,1,"p",null,E),o()(),i(11,"label",3)(12,"span"),n(13,"Senha"),o(),m(14,"input",6),i(15,"div",5),_(16,Se,2,1,"p",null,E),o()(),i(18,"label",3)(19,"span"),n(20,"Regra"),o(),i(21,"select",7)(22,"option",8),n(23,"OPERADOR"),o(),i(24,"option",9),n(25,"ADMIN"),o()()(),i(26,"div",10)(27,"button",11),c("click",function(){return a.onCreate()}),g(28,_e,4,0,"div",12)(29,be,2,0,"span"),o(),i(30,"button",13),c("click",function(){return a.onClose()}),n(31," Cancelar "),o()()()()),t&2){let s,p;l(),h("formGroup",a.userForm),l(6),P("is-invalid",((s=a.userForm.get("username"))==null?null:s.touched)&&((s=a.userForm.get("username"))==null?null:s.invalid)),l(2),b(a.errors("username")),l(5),P("is-invalid",((p=a.userForm.get("password"))==null?null:p.touched)&&((p=a.userForm.get("password"))==null?null:p.invalid)),l(2),b(a.errors("password")),l(11),h("disabled",a.userForm.invalid)("disabled",a.isLoading()||a.userForm.invalid),l(),S(a.isLoading()?28:29),l(2),h("disabled",a.isLoading())}},dependencies:[$,I,ue,ce,A,pe,D,O,j,V],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"],changeDetection:0})};function we(e,r){if(e&1&&(i(0,"p"),n(1),o()),e&2){let t=r.$implicit;l(),C(t)}}function Ue(e,r){e&1&&(i(0,"div",8),m(1,"div",10),i(2,"span"),n(3,"Alterando..."),o()())}function xe(e,r){e&1&&(i(0,"span"),n(1,"Alterar"),o())}var B=class e{modalRef=d(N);userStore=d(v);isLoading=F(()=>this.userStore.updatePasswordState().state==="loading");userForm=new q({id:new w(void 0,[u.required]),password:new w("",[u.required,u.minLength(6)])});constructor(){M(()=>{this.modalRef.data?.id?this.userForm.patchValue({id:this.modalRef.data.id}):this.onClose()})}errors(r){return this.userForm.get(r)?.errors?Object.keys(this.userForm.get(r)?.errors).map(t=>t==="required"?"Campo obrigat\xF3rio":t==="minlength"?`M\xEDnimo de ${this.userForm.get(r)?.getError(t).requiredLength}`:t):null}onUpdate(){this.userForm.valid&&this.userStore.updatePassword({user_id:this.userForm.value.id,new_password:this.userForm.value.password},this.modalRef)}onClose(){this.modalRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=U({type:e,selectors:[["app-update-password"]],standalone:!0,features:[x],decls:17,vars:7,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","password","placeholder","senha","formControlName","password","autocomplete","off",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(t,a){if(t&1&&(i(0,"div",0)(1,"form",1)(2,"h5",2),n(3,"Alterar a Senha"),o(),i(4,"label",3)(5,"span"),n(6,"Senha"),o(),m(7,"input",4),i(8,"div",5),_(9,we,2,1,"p",null,E),o()(),i(11,"div",6)(12,"button",7),c("click",function(){return a.onUpdate()}),g(13,Ue,4,0,"div",8)(14,xe,2,0,"span"),o(),i(15,"button",9),c("click",function(){return a.onClose()}),n(16," Cancelar "),o()()()()),t&2){let s;l(),h("formGroup",a.userForm),l(6),P("is-invalid",((s=a.userForm.get("password"))==null?null:s.touched)&&((s=a.userForm.get("password"))==null?null:s.invalid)),l(2),b(a.errors("password")),l(3),h("disabled",a.userForm.invalid)("disabled",a.isLoading()||a.userForm.invalid),l(),S(a.isLoading()?13:14),l(2),h("disabled",a.isLoading())}},dependencies:[$,I,A,D,O,j,V],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"]})};var Fe=(e,r)=>r.id;function Me(e,r){if(e&1){let t=W();i(0,"button",5),c("click",function(){J(t);let s=T();return K(s.onCriar())}),m(1,"i",6),i(2,"span"),n(3,"Criar"),o()()}}function ye(e,r){e&1&&(i(0,"td",4),n(1,"Carregando"),o())}function Pe(e,r){e&1&&(i(0,"td",4),n(1,"Erro ao carregar dados"),o())}function Ee(e,r){if(e&1){let t=W();i(0,"tr")(1,"td"),n(2),o(),i(3,"td"),n(4),o(),i(5,"td",7)(6,"button",8),c("click",function(){let s=J(t).$implicit,p=T(2);return K(p.onUpdatePassword(s))}),m(7,"i",9),i(8,"span"),n(9,"Alterar Senha"),o()()()()}if(e&2){let t=r.$implicit;l(2),C(t.username),l(2),C(t.role)}}function Re(e,r){e&1&&(i(0,"tr")(1,"td",4),n(2,"Sem resultados"),o()())}function Te(e,r){if(e&1&&_(0,Ee,10,2,"tr",null,Fe,!1,Re,3,0,"tr"),e&2){let t=T();b(t.usersListState().data)}}var ve=class e{modalService=d(Z);userStore=d(v);authService=d(se);usersListState=this.userStore.usersList;isShowAddNewUser=F(()=>this.authService?.auth()?.role==="ADMIN");isAdd=Q(!1,{alias:"add",transform:X});isUpdatePassword=Q(!1,{alias:"updatePassword",transform:X});router=d(ae);userUpdatePassword=null;constructor(){this.userStore.list(),M(()=>{this.openModais()})}onCriar(){this.router.navigate([],{queryParams:{add:!0}})}onUpdatePassword(r){this.userUpdatePassword=r,this.router.navigate([],{queryParams:{updatePassword:!0}})}openModais(){this.isAdd()?this.openModalCreateUser():this.isUpdatePassword()&&this.openModalUpdatePassword()}openModalCreateUser(){this.authService.auth()?.role==="ADMIN"&&this.modalService.open(G,!1,null,[{provide:v,useValue:this.userStore}]).afterClose.subscribe(()=>this.router.navigate([],{queryParams:{}}))}openModalUpdatePassword(){this.modalService.open(B,!1,this.userUpdatePassword,[{provide:v,useValue:this.userStore}]).afterClose.subscribe(()=>this.router.navigate([],{queryParams:{}}))}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=U({type:e,selectors:[["app-users"]],inputs:{isAdd:[1,"add","isAdd"],isUpdatePassword:[1,"updatePassword","isUpdatePassword"]},standalone:!0,features:[k([Z,y,v]),x],decls:16,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-secondary","px-5","d-flex","gap-2"],[1,"table","table-striped","table-bordered","mt-3"],[1,"w-25"],["colspan","3",1,"table-empty"],["type","button",1,"btn","btn-secondary","px-5","d-flex","gap-2",3,"click"],[1,"bi","bi-plus-lg"],[1,"d-inline-flex","w-100","justify-content-center"],[1,"btn","action-edit",3,"click"],[1,"bi","bi-pencil-fill"]],template:function(t,a){if(t&1&&(i(0,"div",0)(1,"h3"),n(2,"Usu\xE1rios"),o(),g(3,Me,4,0,"button",1),o(),i(4,"table",2)(5,"thead")(6,"tr")(7,"th"),n(8,"Login"),o(),i(9,"th"),n(10,"Tipo"),o(),m(11,"th",3),o()(),i(12,"tbody"),g(13,ye,2,0,"td",4)(14,Pe,2,0,"td",4)(15,Te,3,1),o()()),t&2){let s;l(3),S(a.isShowAddNewUser()?3:-1),l(10),S((s=a.usersListState().state)==="loading"?13:s==="error"?14:s==="success"?15:-1)}},styles:[".action-edit[_ngcontent-%COMP%]{display:flex;gap:.5rem;place-self:center;align-items:center}.action-edit[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:none}@media (min-width: 992px){.action-edit[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:block}}"]})};export{ve as UsersComponent};
