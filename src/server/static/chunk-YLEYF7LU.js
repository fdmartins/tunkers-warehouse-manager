import{a as ce,b as B,c as be,d as _e,e as Se,f as O,g as ge,h as ve,i as he,m as Ce}from"./chunk-SH6EOPS2.js";import{a as me,b as A}from"./chunk-2YJ3FLSX.js";import{b as ue}from"./chunk-ODSXTPVL.js";import{a as se}from"./chunk-BAP55IBU.js";import{a as l,b as fe,d as le,e as de}from"./chunk-4IFBPCWC.js";import"./chunk-JLEYIN34.js";import{a as pe}from"./chunk-ZQFK667Q.js";import{a as N}from"./chunk-ANSMRTUX.js";import{$a as x,A as E,Ab as ie,Ba as s,Bb as oe,D as w,Db as ne,Ja as Z,M as Y,O as b,Oa as I,R as Q,Ra as ee,Sa as m,Ta as v,Tb as ae,Va as T,Wa as h,X as f,Xa as C,Ya as k,Z as R,Za as n,_a as a,b as K,bb as U,cb as c,db as p,ga as V,ha as P,i as F,ib as u,jb as y,kb as te,la as M,lb as re,mb as L,o as H,qa as j,w as J,y as W,ya as X}from"./chunk-6VFV3J45.js";import{a as G,b as z}from"./chunk-2VMXMS7J.js";var _=class e{http=f(ae);getBufferById(r){return this.http.post(`${N.REST}/buffers/${r}`,{}).pipe(H(t=>t.map(i=>z(G({},i),{idBuffer:r}))))}updateSku(r,t,i){return this.http.post(`${N.REST}/buffers/${r}/update/sku/${t}`,{sku:i})}updateOccupation(r,t,i,o){return this.http.post(`${N.REST}/buffers/${r}/update/position/${i}/${t}`,{occupied:o})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=Q({token:e,factory:e.\u0275fac})};var Be={bufferState:{data:null,state:"idle"},pesquisando:!1,skuState:{data:null,state:"idle"},positionState:{data:null,state:"idle"}},xe=new K,S=fe(de(Be),le((e,r=f(_),t=f(se))=>({getBufferById(i,o){l(e,{bufferState:{data:null,state:"loading"}}),xe.unsubscribe(),xe=J(0,2e3).pipe(pe(o),W(()=>!e.pesquisando()),b(()=>l(e,{pesquisando:!0})),Y(()=>r.getBufferById(i).pipe(w(1),b(d=>l(e,{bufferState:{data:d,state:"success"}})),E(d=>(l(e,{bufferState:{data:null,state:"error"}}),t.error(d.message),F)))),b(()=>l(e,{pesquisando:!1}))).subscribe()},updateSku(i,o,d,g,D){l(e,{skuState:{data:null,state:"loading"}}),r.updateSku(i,o,d).pipe(w(1),b(()=>{l(e,{skuState:{data:null,state:"success"}}),g.close(),t.success("Sku alterado com sucesso."),this.getBufferById(i,D)}),E(q=>(l(e,{skuState:{data:null,state:"error"}}),t.error(q.message),F))).subscribe()},updateOccupation(i,o,d,g,D){l(e,{skuState:{data:null,state:"loading"}}),r.updateOccupation(i,o,d,g).pipe(w(1),b(()=>{l(e,{positionState:{data:null,state:"success"}}),t.success("Posi\xE7\xE3o alterada com sucesso."),this.getBufferById(i,D)}),E(q=>(l(e,{positionState:{data:null,state:"error"}}),t.error(q.message),F))).subscribe()}})));function Ee(e,r){if(e&1&&(n(0,"p"),u(1),a()),e&2){let t=r.$implicit;s(),y(t)}}function we(e,r){e&1&&(n(0,"div",8),x(1,"div",10),n(2,"span"),u(3,"Confirmando..."),a()())}function Re(e,r){e&1&&(n(0,"span"),u(1,"Confirmar"),a())}var $=class e{modalRef=f(me);bufferStore=f(S);destroyRef=f(M);isLoading=Z(!1);bufferForm=new Se({idBuffer:new O(void 0,[B.required]),row_id:new O(void 0,[B.required]),sku:new O("",[B.required,B.minLength(3)])});constructor(){let r=this.modalRef.data;this.bufferForm.patchValue({sku:r.sku,row_id:r.row_id,idBuffer:r.idBuffer})}errors(r){return this.bufferForm.get(r)?.errors?Object.keys(this.bufferForm.get(r)?.errors).map(t=>t==="required"?"Campo obrigat\xF3rio":t==="minlength"?`M\xEDnimo de ${this.bufferForm.get(r)?.getError(t).requiredLength}`:t):null}onUpdate(){this.bufferForm.valid&&this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,this.bufferForm.value.sku,this.modalRef,this.destroyRef)}onClearLine(){this.bufferStore.updateSku(this.bufferForm.value.idBuffer,this.bufferForm.value.row_id,null,this.modalRef,this.destroyRef)}onClose(){this.modalRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=R({type:e,selectors:[["app-sku-form"]],standalone:!0,features:[L],decls:19,vars:8,consts:[[1,"card"],[1,"card-body","d-flex","flex-column","gap-3",3,"formGroup"],[1,"card-title"],[1,"d-flex","flex-column","gap-2"],["type","text","placeholder","sku","formControlName","sku","autocomplete","off",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","justify-content-end","gap-3"],[1,"btn","btn-success","w-50",3,"click","disabled"],[1,"d-flex","align-items-center","justify-content-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","w-50",3,"click","disabled"],["role","status",1,"spinner-border","text-light",2,"width","20px","height","20px"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"form",1)(2,"h5",2),u(3,"SKU"),a(),n(4,"label",3)(5,"span"),u(6,"Sku"),a(),x(7,"input",4),n(8,"div",5),C(9,Ee,2,1,"p",null,h),a()(),n(11,"div",6)(12,"button",7),c("click",function(){return i.onUpdate()}),I(13,we,4,0,"div",8)(14,Re,2,0,"span"),a(),n(15,"button",9),c("click",function(){return i.onClearLine()}),u(16," Limpar Linha "),a(),n(17,"button",9),c("click",function(){return i.onClose()}),u(18," Cancelar "),a()()()()),t&2){let o;s(),m("formGroup",i.bufferForm),s(6),v("is-invalid",((o=i.bufferForm.get("sku"))==null?null:o.touched)&&((o=i.bufferForm.get("sku"))==null?null:o.invalid)),s(2),k(i.errors("sku")),s(3),m("disabled",i.bufferForm.invalid)("disabled",i.isLoading()||i.bufferForm.invalid),s(),T(i.isLoading()?13:14),s(2),m("disabled",i.isLoading()),s(2),m("disabled",i.isLoading())}},dependencies:[Ce,ge,ce,be,_e,ve,he],styles:["[_nghost-%COMP%]{width:500px;padding:1rem}"]})};function Me(e,r){e&1&&(n(0,"tr")(1,"td",3),u(2,"Carregando..."),a()())}function Ie(e,r){e&1&&(n(0,"tr")(1,"td",3),u(2,"Erro ao carregar os dados"),a()())}function Te(e,r){if(e&1){let t=U();n(0,"button",8),c("click",function(){let o=V(t).$implicit,d=p().$implicit,g=p(2);return P(g.onUpdateOccupation(d,o))}),x(1,"img",9),n(2,"div",10),u(3),a()()}if(e&2){let t=r.$implicit,i=p().$implicit,o=p(2);v("border-0",o.isNotLogged()),m("disabled",o.isNotLogged()),s(),m("src","static/icons/"+i.type+".png",X),ee("data-occupied",t.occupied),s(2),y(t.pos)}}function Le(e,r){if(e&1){let t=U();n(0,"tr")(1,"td",4)(2,"button",5),c("click",function(){let o=V(t).$implicit,d=p(2);return P(d.onOpenSkuForm(o))}),u(3),a()(),n(4,"td")(5,"div",6),C(6,Te,4,6,"button",7,h),a()()()}if(e&2){let t=r.$implicit,i=p(2);s(2),v("border-0",i.isNotLogged()),m("disabled",i.isNotLogged()),s(),te(" ",t.sku||"LIVRE"," "),s(3),k(t.positions)}}function Ne(e,r){e&1&&(n(0,"tr")(1,"td",3),u(2,"Sem registros"),a()())}function Oe(e,r){if(e&1&&C(0,Le,8,4,"tr",null,h,!1,Ne,3,0,"tr"),e&2){let t=p();k(t.bufferState().data)}}function $e(e){return e?e.replace("-"," "):""}var ye=class e{bufferName=j("Buffer",{alias:"name",transform:$e});bufferId=j(0,{alias:"id",transform:ie});bufferStore=f(S);modalService=f(A);authService=f(ue);destroyRef=f(M);bufferState=this.bufferStore.bufferState;isNotLogged=oe(()=>!this.authService.isLogged());constructor(){ne(()=>{this.bufferId()&&this.loadBufferById()},{allowSignalWrites:!0})}loadBufferById(){this.bufferStore.getBufferById(this.bufferId(),this.destroyRef)}onOpenSkuForm(r){this.isNotLogged()||this.modalService.open($,!0,r,[{provide:S,useValue:this.bufferStore}])}onUpdateOccupation(r,t){this.isNotLogged()||this.bufferStore.updateOccupation(r.idBuffer,t.pos,r.row_id,!t.occupied,this.destroyRef)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=R({type:e,selectors:[["app-buffer"]],inputs:{bufferName:[1,"name","bufferName"],bufferId:[1,"id","bufferId"]},standalone:!0,features:[re([_,S,A]),L],decls:14,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center"],[1,"table","table-striped"],[1,"w-25",2,"min-width","fit-content"],["colspan","2",1,"text-center"],[1,"text-center"],[1,"btn",3,"click","disabled"],[1,"d-flex","gap-1"],[1,"btn","d-flex","flex-column","align-items-center",3,"border-0","disabled"],[1,"btn","d-flex","flex-column","align-items-center",3,"click","disabled"],["height","30",1,"bobina_pallet",3,"src"],[2,"font-size","11px","color","#1b1b1b"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"h3"),u(2),a()(),n(3,"table",1)(4,"thead")(5,"tr")(6,"th",2),u(7,"SKU"),a(),n(8,"th"),u(9,"Ocupa\xE7\xE3o"),a()()(),n(10,"tbody"),I(11,Me,3,0,"tr")(12,Ie,3,0,"tr")(13,Oe,3,1),a()()),t&2){let o;s(2),y(i.bufferName()),s(9),T((o=i.bufferState().state)==="loading"?11:o==="error"?12:o==="success"?13:-1)}},styles:[".bobina_pallet[data-occupied=true][_ngcontent-%COMP%]{filter:invert(22%) sepia(75%) saturate(6197%) hue-rotate(125deg) brightness(95%) contrast(1151%)}.bobina_pallet[data-occupied=false][_ngcontent-%COMP%]{filter:invert(22%) sepia(15%) saturate(67%) hue-rotate(339deg) brightness(15%) contrast(11%)}"]})};export{ye as BufferComponent};
